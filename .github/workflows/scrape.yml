name: Scrape EAMCET Results (Mega Job)

on:
  workflow_dispatch:
    inputs:
      districts:
        description: 'Districts to scrape (11,12,13 are high yield)'
        required: true
        default: '12,11,13,14,15'
      workers:
        description: 'MAXED OUT: 8 workers (Aggressive for free tier)'
        required: true
        default: '8'
      serial_start:
        description: 'Serial number start'
        required: true
        default: '1000'
      serial_end:
        description: 'Serial number end (expanded to reach 80k)'
        required: true
        default: '2500'

jobs:
  scrape-all:
    name: Mega Scrape Job
    runs-on: ubuntu-latest
    timeout-minutes: 240
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Chrome
          # The specialized setup-chrome action is better for stability
        uses: browser-actions/setup-chrome@v1

      - name: Install Dependencies
        run: |
          pip install selenium webdriver-manager

      - name: Run Mega Scraper
        run: |
          python github_scraper.py \
            --districts "${{ inputs.districts }}" \
            --workers "${{ inputs.workers }}" \
            --serial-start "${{ inputs.serial_start }}" \
            --serial-end "${{ inputs.serial_end }}"

      - name: Show Results Summary
        if: always()
        run: |
          echo "=== Results Summary ==="
          if [ -f github_results.csv ]; then
            LINES=$(wc -l < github_results.csv)
            echo "Total records found in this run: $((LINES - 1))"
            head -5 github_results.csv
            echo "..."
            tail -5 github_results.csv
          else
            echo "No results file found."
          fi

      - name: Upload Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: eamcet-results-mega
          path: github_results.csv
